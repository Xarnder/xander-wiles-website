<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convolution Explorer</title>

    <!-- Theme-aware SVG icons (modern browsers) -->
    <link rel="icon" href="favicon.ico" sizes="any"> <!-- Fallback for older browsers -->
    <link rel="icon" href="favicon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">

    <!-- Fallback PNG icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

    <!-- Other essential links -->
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111115" media="(prefers-color-scheme: dark)">

    <!-- Global Site Header Styles -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Tool Specific Styles -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Global Navigation Placeholder -->
    <div id="main-nav-placeholder"></div>
    <script src="/assets/js/nav-loader.js"></script>

    <!-- Main Tool Container -->
    <main class="container">
        <header class="tool-header">
            <h1>Interactive Convolution Visualizer</h1>
            <p>Understand how Kernels transform Input Matrices</p>
        </header>

        <!-- Controls Section -->
        <section class="controls-card glass-panel">
            <div class="control-group">
                <label for="gridSize">Grid Size (N x N)</label>
                <input type="number" id="gridSize" min="3" max="32" value="5">
            </div>

            <div class="control-group">
                <label for="kernelSizeSelect">Kernel Size</label>
                <select id="kernelSizeSelect">
                    <option value="2">2 x 2</option>
                    <option value="3" selected>3 x 3</option>
                    <option value="5">5 x 5</option>
                    <option value="7">7 x 7</option>
                </select>
            </div>

            <div class="control-group">
                <label for="modeSelect">Mode</label>
                <select id="modeSelect">
                    <option value="numerical">Numerical Grid</option>
                    <option value="image">Image Processing</option>
                </select>
            </div>

            <div class="control-group" id="csvUploadGroup">
                <label for="csvUpload">Upload CSV (Grid)</label>
                <input type="file" id="csvUpload" accept=".csv">
            </div>

            <div class="control-group" id="fileUploadGroup" style="display: none;">
                <label for="imageUpload">Upload Image</label>
                <input type="file" id="imageUpload" accept="image/*">
            </div>

            <div class="control-group">
                <label for="rangeToggle">Value Range</label>
                <select id="rangeToggle">
                    <option value="10">0 - 10 (Simple)</option>
                    <option value="255">0 - 255 (Grayscale)</option>
                </select>
            </div>

            <div class="control-group">
                <label for="kernelSelect">Kernel / Filter</label>
                <select id="kernelSelect">
                    <!-- Populated by JS -->
                </select>
            </div>

            <!-- Dual Kernel Controls -->
            <div class="control-group checkbox-group">
                <input type="checkbox" id="dualKernelCheck">
                <label for="dualKernelCheck">Enable 2nd Kernel</label>
            </div>

            <div class="control-group" id="dualKernelControls" style="display: none;">
                <label for="kernelSelectB">2nd Kernel</label>
                <select id="kernelSelectB">
                    <!-- Populated by JS -->
                </select>
                <label for="mixModeSelect" style="margin-top: 5px;">Mix Mode</label>
                <select id="mixModeSelect">
                    <option value="magnitude">Magnitude (Sobel)</option>
                    <option value="add">Add (A + B)</option>
                    <option value="sub">Subtract (A - B)</option>
                </select>
            </div>

            <div class="control-group checkbox-group">
                <input type="checkbox" id="paddingCheck">
                <label for="paddingCheck">Use Padding (Zero-padding)</label>
            </div>

            <button id="refreshBtn" class="btn-action">Generate New Input</button>

            <!-- Download Section -->
            <div class="control-group" id="downloadGroup"
                style="display: none; margin-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 10px;">
                <label>Download Result</label>

                <div style="margin-bottom: 10px; display: flex; gap: 15px; font-size: 0.9rem;">
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="dlFormat" value="png" checked> PNG
                    </label>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="radio" name="dlFormat" value="jpeg"> JPG
                    </label>
                </div>

                <div class="checkbox-group" style="margin-bottom: 10px;">
                    <input type="checkbox" id="dlOriginalCheck">
                    <label for="dlOriginalCheck">Process Original Resolution</label>
                </div>

                <div class="btn-row">
                    <button id="downloadBtn" class="btn-small">Save Image</button>
                </div>
            </div>
        </section>

        <!-- Visualization Section -->
        <section class="vis-container">

            <!-- Input Grid -->
            <div class="stage">
                <h3>Input Image</h3>
                <div class="info-tag" id="inputDims">5x5</div>
                <div id="inputGrid" class="grid-display glass-panel"></div>
                <!-- Canvas for Image Mode -->
                <canvas id="inputCanvas" class="glass-panel" style="display: none;"></canvas>
            </div>

            <!-- Operator -->
            <div class="operator">
                <span>*</span>
                <div class="kernel-display glass-panel">
                    <h4>Kernel A</h4>
                    <div id="kernelGrid" class="grid-kernel"></div>

                    <div id="kernelWrapperB"
                        style="display: none; margin-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 5px;">
                        <h4>Kernel B</h4>
                        <div id="kernelGridB" class="grid-kernel"></div>
                    </div>
                </div>
                <span>=</span>
            </div>

            <!-- Output Grid -->
            <div class="stage">
                <h3>Output Feature Map</h3>
                <div class="info-tag" id="outputDims">3x3</div>
                <div id="outputGrid" class="grid-display glass-panel"></div>
                <!-- Canvas for Image Mode -->
                <canvas id="outputCanvas" class="glass-panel" style="display: none;"></canvas>
            </div>

        </section>

        <!-- Calculation Breakdown Panel -->
        <section id="calcBreakdown" class="calc-panel glass-panel" style="display: none;">
            <h3>Calculation Breakdown</h3>
            <div id="calcContent" class="calc-content">Select an output cell to see the math.</div>
        </section>

        <!-- Debug / Console Output on Screen -->
        <section class="debug-panel glass-panel">
            <h3>Debug Log</h3>
            <div id="debugLog"></div>
        </section>

    </main>

    <script src="script.js"></script>
</body>

</html>