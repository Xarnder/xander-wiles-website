<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Face Cropper</title>

    <!-- Theme-aware SVG icons (modern browsers) -->
    <link rel="icon" href="favicon.ico" sizes="any"> <!-- Fallback for older browsers -->
    <link rel="icon" href="favicon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">

    <!-- Fallback PNG icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

    <!-- Other essential links -->
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111115" media="(prefers-color-scheme: dark)">

    <!-- Global Header Styles and Scripts -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- Tool Specific CSS -->
    <link rel="stylesheet" href="style.css">

    <!-- Libraries: JSZip for zipping downloads -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <!-- Library: Face-API.js -->
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
</head>

<body>

    <!-- Global Header Injection -->
    <div id="main-nav-placeholder"></div>
    <script src="/assets/js/nav-loader.js"></script>

    <main class="container">
        <header class="tool-header">
            <h1>Auto Face Cropper</h1>
            <p>Upload a folder of images. AI will detect the largest face and crop it automatically.</p>
            <p class="description">
                Batch crop faces from a folder of photos automatically using AI.
            </p>
            <p class="privacy-notice">
                ðŸ”’ All processing is done locally on your device. Your photos are completely private and never uploaded
                to any server.
            </p>
        </header>

        <!-- Controls Card -->
        <section class="card controls">
            <div class="input-group">
                <label for="imageInput" class="custom-file-upload">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="17 8 12 3 7 8"></polyline>
                        <line x1="12" y1="3" x2="12" y2="15"></line>
                    </svg>
                    Select Folder
                </label>
                <input type="file" id="imageInput" webkitdirectory directory multiple>
            </div>

            <div class="setting-group">
                <label>Aspect Ratio (W : H)</label>
                <div class="ratio-inputs">
                    <input type="number" id="ratioWidth" placeholder="W" value="1" min="0.1" step="0.1">
                    <span>:</span>
                    <input type="number" id="ratioHeight" placeholder="H" value="1" min="0.1" step="0.1">
                </div>
                <div class="checkbox-group compact-checkbox">
                    <input type="checkbox" id="useOriginalRatio">
                    <label for="useOriginalRatio">Use original aspect ratio</label>
                </div>
            </div>

            <div class="setting-group">
                <label for="paddingInput">Face Padding: <span id="paddingVal">50</span>%</label>
                <input type="range" id="paddingInput" min="0" max="200" value="50">
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="excludeNoFace">
                <label for="excludeNoFace">Exclude images with no face detected</label>
            </div>

            <button id="processBtn" class="btn-primary" disabled>
                Process Batch
            </button>

            <button id="downloadBtn" class="btn-primary" disabled>
                Download ZIP
            </button>
        </section>

        <!-- Preview Card -->
        <section id="previewCard" class="card preview-container" style="display: none;">
            <h3>Preview (First Image)</h3>
            <div class="preview-box">
                <canvas id="previewCanvas"></canvas>
            </div>
            <p class="preview-hint">Adjust padding above to see changes live.</p>
        </section>

        <!-- Status Area -->
        <div id="statusArea" class="status-text">Loading AI Models...</div>

        <!-- Results Grid -->
        <section id="gallery" class="gallery-grid">
            <!-- Cropped images appear here -->
        </section>
    </main>

    <!-- Lightbox Modal -->
    <div id="lightboxModal" class="lightbox">
        <span class="close-btn" id="closeLightbox">&times;</span>

        <div class="zoom-controls">
            <button class="icon-btn" id="zoomOutBtn">&minus;</button>
            <span id="zoomLevel">100%</span>
            <button class="icon-btn" id="zoomInBtn">&plus;</button>
        </div>

        <button class="nav-btn prev-btn" id="prevSlide">&#10094;</button>
        <img class="lightbox-content" id="lightboxImage">
        <button class="nav-btn next-btn" id="nextSlide">&#10095;</button>
    </div>

    <script src="script.js"></script>
</body>

</html>