<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ML Loss Function Visualizer</title>

    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="favicon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111115" media="(prefers-color-scheme: dark)">

    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="style.css">

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
</head>
<body>
    <div id="main-nav-placeholder"></div>
    <script src="/assets/js/nav-loader.js"></script>

    <div id="canvas-container"></div>

    <!-- UI Overlay Card -->
    <div class="ui-card">
        <div class="card-header">
            <h2>Gradient Descent</h2>
            <button id="btn-info" class="icon-btn" aria-label="Explanation">?</button>
        </div>
        <p class="subtitle">Click landscape to place single ball</p>
        
        <div class="viz-wrapper">
            <div class="viz-header">Avg. Network Weights</div>
            <div class="viz-container">
                <canvas id="nn-viz" width="280" height="80"></canvas>
            </div>
            
            <div class="viz-header" style="margin-top:10px;">Average Loss History</div>
            <div class="viz-container">
                <canvas id="loss-chart" width="280" height="80"></canvas>
            </div>
        </div>

        <div class="section-title">Optimizer Parameters</div>
        <div class="control-group">
            <div class="label-row">
                <label for="learning-rate">Learning Rate</label>
                <span id="lr-value" class="value-tag">0.01</span>
            </div>
            <input type="range" id="learning-rate" min="0.001" max="0.1" step="0.001" value="0.01">

            <div class="label-row" style="margin-top:12px;">
                <label for="momentum">Momentum</label>
                <span id="mom-value" class="value-tag">0.00</span>
            </div>
            <input type="range" id="momentum" min="0.0" max="0.95" step="0.05" value="0.0">

            <div class="label-row" style="margin-top:12px;">
                <label for="noise">SGD Noise (Jitter)</label>
                <span id="noise-value" class="value-tag">0.0</span>
            </div>
            <input type="range" id="noise" min="0.0" max="1.0" step="0.1" value="0.0">
        </div>

        <div class="section-title" style="margin-top:20px;">Landscape Settings</div>
        <div class="control-group">
            <div class="label-row">
                <label for="scale">Scale</label>
                <span id="scale-value" class="value-tag">1.0</span>
            </div>
            <input type="range" id="scale" min="0.2" max="2.0" step="0.1" value="1.0">

            <div class="label-row" style="margin-top:8px;">
                <label for="intensity">Intensity</label>
                <span id="intensity-value" class="value-tag">1.0</span>
            </div>
            <input type="range" id="intensity" min="0.2" max="2.0" step="0.1" value="1.0">

            <div class="label-row" style="margin-top:8px;">
                <label for="complexity">Complexity</label>
                <span id="complexity-value" class="value-tag">3</span>
            </div>
            <input type="range" id="complexity" min="1" max="5" step="1" value="3">
        </div>

        <!-- BUTTONS RESTORED HERE -->
        <div class="button-group" style="margin-top:20px;">
            <button id="btn-spawn-swarm" class="btn btn-primary" style="background: linear-gradient(45deg, #4a90e2, #9013fe);">
                <span>üöÄ Swarm</span>
            </button>
            <button id="btn-new-landscape" class="btn btn-secondary">
                <span>üé≤ New Map</span>
            </button>
        </div>
        
        <div class="button-group">
            <button id="btn-toggle-wire" class="btn btn-secondary">
                <span>üï∏Ô∏è Wire</span>
            </button>
            <button id="btn-toggle-trails" class="btn btn-secondary">
                <span>„Ä∞Ô∏è Trails</span>
            </button>
            <button id="btn-reset-ball" class="btn btn-secondary">
                <span>‚Ü∫ Reset</span>
            </button>
        </div>

        <div class="stats-grid" style="margin-top:20px;">
            <div class="stat-item">
                <span class="stat-label">Avg Loss</span>
                <span id="loss-val" class="stat-value">--</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Epochs</span>
                <span id="epoch-val" class="stat-value">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Agents</span>
                <span id="agents-val" class="stat-value">0</span>
            </div>
        </div>
        
        <div id="debug-log">Initializing...</div>
    </div>

    <!-- EXPLANATION MODAL -->
    <div id="info-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>How Neural Networks Learn</h2>
                <button id="btn-close-modal" class="icon-btn">√ó</button>
            </div>
            <div class="modal-body">
                <div class="concept-block">
                    <h3>‚õ∞Ô∏è The Landscape (Loss Function)</h3>
                    <p>Think of training an AI as a hiker trying to find the lowest point in a mountain range in the dark. The "Height" represents <strong>Error (Loss)</strong>. The lower the ball goes, the better the AI performs.</p>
                </div>

                <div class="concept-block">
                    <h3>üê¢ Learning Rate (Step Size)</h3>
                    <p>How big of a step the hiker takes downhill. 
                    <br>‚Ä¢ <strong>Too Small:</strong> Takes forever to reach the bottom.
                    <br>‚Ä¢ <strong>Too Big:</strong> The hiker might step over the valley and end up on the other side (divergence).</p>
                </div>

                <div class="concept-block">
                    <h3>üèéÔ∏è Momentum (Velocity)</h3>
                    <p>Standard Gradient Descent stops immediately if the slope is flat. <strong>Momentum</strong> gives the ball mass. If it's rolling fast, it can power through small bumps and shallow valleys (local minima) to find deeper, better solutions.</p>
                </div>

                <div class="concept-block">
                    <h3>üé≤ SGD Noise (Stochastic Gradient Descent)</h3>
                    <p>In real training, we don't calculate the slope using <i>all</i> data at once (too slow). We use small batches. This creates "noise" or jitter in the movement. This randomness shakes the ball, helping it vibrate out of bad spots where it might get stuck.</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="script.js"></script>
</body>
</html>