<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Manager</title>

    <!-- Theme-aware SVG icons -->
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="icon" href="favicon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">

    <!-- Fallback PNG icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

    <!-- Other essential links -->
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111115" media="(prefers-color-scheme: dark)">

    <!-- Global Header CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">

    <!-- App Specific CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!-- Global Header Placeholder -->
    <div id="main-nav-placeholder"></div>
    <script src="/assets/js/nav-loader.js"></script>

    <main class="app-container">

        <!-- Login View -->
        <section id="login-view">
            <div class="glass-card login-card">
                <h1>Network Manager</h1>
                <p>Track connections, manage friends.</p>
                <button id="google-login-btn" class="btn primary-btn">
                    Sign in with Google
                </button>
                <p class="debug-msg" id="auth-debug"></p>
            </div>
        </section>

        <!-- Dashboard View (Hidden by default) -->
        <section id="dashboard-view" class="hidden">
            <header class="app-header">
                <div class="header-left">
                    <h2>My Network</h2>
                    <span id="user-name"></span>
                    <span id="storage-stats" style="font-size:0.8rem; opacity:0.7; margin-left:10px"></span>
                </div>
                <div class="header-right">
                    <button id="mobile-menu-btn" class="btn icon-btn"
                        style="display:none; font-size:1.5rem; padding:5px 10px;">â˜°</button>
                    <div id="header-actions" class="header-actions">
                        <button id="export-btn" class="btn secondary-btn" style="padding: 8px 15px;">Export</button>
                        <button id="add-btn" class="btn primary-btn">+ Add Person</button>
                        <button id="logout-btn" class="btn secondary-btn"
                            style="border-color:var(--danger); color:var(--danger)">Logout</button>
                    </div>
                </div>
            </header>

            <!-- Calendar Widget -->
            <div id="calendar-widget" class="glass-card calendar-widget">
                <div class="calendar-header">
                    <button id="cal-prev" class="calendar-nav-btn">&lt;</button>
                    <span id="cal-month-year">Month Year</span>
                    <button id="cal-next" class="calendar-nav-btn">&gt;</button>
                </div>
                <div id="calendar-list" class="calendar-list">
                    <!-- Top 5 items go here -->
                </div>
            </div>

            <!-- Search / Filter -->
            <div class="search-bar">
                <input type="text" id="search-input" placeholder="Search friends...">
            </div>

            <!-- Grid -->
            <div id="friends-grid" class="friends-grid">
                <!-- Javascript fills this -->
                <div class="loader">Loading...</div>
            </div>
        </section>
    </main>

    <!-- Modal Form -->
    <div id="modal" class="modal hidden">
        <div class="glass-card modal-content">
            <span id="close-modal">&times;</span>
            <h3 id="modal-title">Add Person</h3>

            <form id="friend-form">
                <input type="hidden" id="edit-id"> <!-- Stores ID if editing -->

                <!-- Photo Upload -->
                <div class="photo-upload-container">
                    <label for="photo-file" id="photo-preview">
                        <span>Tap to Add Photo</span>
                    </label>
                    <input type="file" id="photo-file"
                        accept="image/png, image/jpeg, image/webp, image/avif, image/heic, image/heif" hidden>
                </div>

                <div class="form-row">
                    <div class="input-group">
                        <label>Name</label>
                        <input type="text" id="inp-name" required placeholder="Full Name">
                    </div>
                    <div class="input-group">
                        <label>Where Met</label>
                        <input type="text" id="inp-met" placeholder="e.g. Conference">
                    </div>
                </div>

                <div class="form-row">
                    <div class="input-group">
                        <label>Origin / Location</label>
                        <input type="text" id="inp-origin" placeholder="e.g. London">
                    </div>
                    <div class="input-group">
                        <label>Line of Work</label>
                        <input type="text" id="inp-work" placeholder="e.g. Designer">
                    </div>
                </div>

                <div class="input-group">
                    <label>Phone Number</label>
                    <input type="tel" id="inp-phone" placeholder="+1 234 567 8900">
                </div>

                <div class="form-row">
                    <div class="input-group">
                        <label>Keep in Touch</label>
                        <div style="display:flex; gap:10px;">
                            <input type="number" id="inp-freq-val" value="1" min="1" style="flex:1">
                            <select id="inp-freq-unit"
                                style="flex:1; background:rgba(0,0,0,0.3); color:white; border:1px solid var(--glass-border); border-radius:8px; padding:10px;">
                                <option value="1">Days</option>
                                <option value="7">Weeks</option>
                                <option value="30">Months</option>
                            </select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Last Caught Up</label>
                        <input type="date" id="inp-last">
                    </div>
                </div>

                <div class="input-group">
                    <label>Notes</label>
                    <textarea id="inp-notes" rows="3" placeholder="Interests, family info..."></textarea>
                </div>

                <div id="status-msg"></div>
                <button type="submit" class="btn primary-btn full-width">Save</button>
            </form>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal hidden">
        <div class="modal-content glass-card">
            <span id="close-export" class="close">&times;</span>
            <h2>Export Data</h2>
            <p style="margin-bottom:20px; color:var(--text-muted)">Choose a format to download your network data.</p>
            <div class="modal-actions" style="flex-direction:column; gap:10px">
                <button id="export-csv" class="btn secondary-btn full-width">Export CSV Only</button>
                <button id="export-json" class="btn secondary-btn full-width">Export JSON Only</button>
                <hr style="width:100%; border:0; border-top:1px solid var(--glass-border); margin:10px 0;">
                <button id="export-zip-csv" class="btn primary-btn full-width">Export CSV Bundle (ZIP + Images)</button>
                <button id="export-zip-html" class="btn primary-btn full-width">Export Offline Website (ZIP +
                    Viewer)</button>
            </div>
            <div id="export-status"
                style="margin-top:10px; font-size:0.9rem; color:var(--text-main); text-align:center;"></div>
        </div>
    </div>

    <!-- Crop Modal -->
    <div id="crop-modal" class="modal hidden">
        <div class="glass-card modal-content" style="max-width: 600px;">
            <h3>Crop Photo</h3>
            <div class="crop-container">
                <img id="crop-image" src="" alt="Image to crop">
            </div>
            <div class="modal-actions" style="display:flex; gap:10px; justify-content:flex-end;">
                <button id="crop-cancel" class="btn secondary-btn"
                    style="color:var(--danger); border-color:var(--danger)">Cancel</button>
                <button id="crop-save" class="btn primary-btn">Crop & Save</button>
            </div>
        </div>
    </div>

    <!-- Utilities -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>

    <!-- Firebase SDKs & Logic -->
    <script type="module" src="script.js"></script>
</body>

</html>