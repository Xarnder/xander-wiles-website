<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Web Image Editor</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Custom Stylesheet -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="/assets/css/style.css">


    <!-- Theme-aware SVG icons (modern browsers) -->
    <link rel="icon" href="favicon.ico" sizes="any"> <!-- Fallback for older browsers -->
    <link rel="icon" href="favicon-light.svg" type="image/svg+xml" media="(prefers-color-scheme: light)">
    <link rel="icon" href="favicon-dark.svg" type="image/svg+xml" media="(prefers-color-scheme: dark)">

    <!-- Fallback PNG icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">

    <!-- Other essential links -->
    <link rel="manifest" href="site.webmanifest">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#111115" media="(prefers-color-scheme: dark)">
</head>
<div id="main-nav-placeholder"></div>
<body>
    <div class="background-overlay"></div>

    <header class="site-header">
        <div class="header-content">
            <a href="#" class="logo">In-Browser Image Editor</a>
            <!-- NEW: Touch Mode Toggle -->
            <label class="toggle-switch header-toggle">
                Touch Mode
                <input type="checkbox" id="touch-mode-toggle" />
                <span class="toggle-knob"></span>
            </label>
        </div>
    </header>

    <main class="app-container">
        <!-- Step 1: Upload Original Image -->
        <section id="upload-step" class="glass-card">
            <h2>Step 1: Start a New Project</h2>
            <p>Select the full-size original image you want to edit.</p>
            <div class="centered-content">
                <label for="image-upload" class="action-btn">Upload Original Image</label>
                <input type="file" id="image-upload" accept="image/*" style="display:none;" />
            </div>
            <p id="upload-status" class="status-message"></p>
        </section>

        <!-- Step 2: Crop Tool -->
        <section id="crop-step" class="glass-card hidden">
            <h2>Step 2: Select and Export Crop Area</h2>
            <p>Click and drag on the image to select the area. Use the dropdown to lock the aspect ratio.</p>
            <div class="canvas-container">
                <canvas id="crop-canvas"></canvas>
            </div>
            <div class="controls-bar">
                <div class="control-group">
                    <label for="aspect-ratio-select">Aspect Ratio</label>
                    <select id="aspect-ratio-select">
                        <option value="0">Freeform</option>
                        <option value="1">1:1 (Square)</option>
                        <option value="1.3333">4:3 (Standard)</option>
                        <option value="1.5">3:2 (Photography)</option>
                        <option value="1.6">16:10 (Widescreen)</option>
                        <option value="1.7777">16:9 (HD Video)</option>
                        <option value="2.3333">21:9 (Cinema)</option>
                    </select>
                </div>
                <button id="export-crop-btn" class="action-btn" disabled>Download Cropped Area</button>
            </div>
             <p class="status-message">After downloading, edit the image in your preferred software, then proceed to the next step.</p>
        </section>

        <!-- Step 3: Upload Edited Crop -->
        <section id="re-upload-step" class="glass-card hidden">
            <h2>Step 3: Import Your Edited Image</h2>
            
            <!-- NEW: Preview Section -->
            <div class="preview-container">
                <div class="preview-box">
                    <h3>Original with Crop Area</h3>
                    <div class="canvas-container">
                        <canvas id="original-preview-canvas"></canvas>
                    </div>
                </div>
                <div class="preview-box">
                    <h3>Your Cropped Image</h3>
                    <div class="canvas-container">
                        <canvas id="cropped-preview-canvas"></canvas>
                    </div>
                </div>
            </div>
            
            <p>Upload the modified cropped image. It must be the same size as the area you exported.</p>
             <div class="centered-content">
                <label for="edited-upload" class="action-btn">Upload Edited Crop</label>
                <input type="file" id="edited-upload" accept="image/*" style="display:none;" />
            </div>
            <p id="re-upload-status" class="status-message"></p>
        </section>

        <!-- Step 4: Masking Tool -->
        <section id="mask-step" class="glass-card hidden">
            <h2>Step 4: Blend Your Edits</h2>
            <p>Use the brush to reveal your edited image. Use the eraser to hide it and show the original.</p>
            <div class="canvas-container">
                 <canvas id="mask-canvas"></canvas>
            </div>
            <div class="controls-bar">
                <div class="tool-select">
                    <button id="brush-btn" class="tool-btn active">Brush</button>
                    <button id="eraser-btn" class="tool-btn">Eraser</button>
                </div>
                <div class="control-group">
                    <label for="brush-size-slider">Brush Size: <span id="brush-size-value">50</span>px</label>
                    <input type="range" id="brush-size-slider" min="1" max="500" value="50" step="1" />
                </div>
                <div class="control-group">
                    <label for="brush-softness-slider">Softness: <span id="brush-softness-value">25</span>%</label>
                    <input type="range" id="brush-softness-slider" min="0" max="100" value="25" step="1" />
                </div>
                 <label class="toggle-switch">
                    Show Mask
                    <input type="checkbox" id="show-mask-toggle" />
                    <span class="toggle-knob"></span>
                </label>
            </div>
            <div class="centered-content final-export">
                 <button id="save-final-btn" class="action-btn">Download Final Image</button>
            </div>
        </section>
    </main>

    <script src="script.js"></script>
    <script src="/assets/js/nav-loader.js"></script>
</body>
</html>